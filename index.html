<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>PDF Bore Log Extractor (Header + Layers + SPT)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="styles.css"/>

  <!-- PDF.js UMD (global pdfjsLib) -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script>
    // Set worker (required)
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js";
  </script>

  <!-- OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.1.1/dist/tesseract.min.js"></script>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="dot"></div>
      <div>
        <div class="title">PDF Bore Log Extractor</div>
        <div class="subtitle">Draw ROIs → Extract Header + Layers + SPT → Export JSON</div>
      </div>
    </div>

    <div class="toolbar">
      <label class="btn">
        <input id="pdfInput" type="file" accept="application/pdf" hidden />
        Upload PDF
      </label>

      <div class="pill">
        <button id="prevBtn" class="btn" disabled>Prev</button>
        <span class="mono" id="pageLabel">Page - / -</span>
        <button id="nextBtn" class="btn" disabled>Next</button>
      </div>

      <div class="pill">
        <span>Total Depth (ft)</span>
        <input id="totalDepth" class="input small mono" type="number" value="36" step="0.1" />
      </div>

      <select id="langSelect" class="select">
        <option value="eng" selected>English (eng)</option>
      </select>

      <button id="renderBtn" class="btn primary" disabled>Render</button>

      <div class="pill">
        <span class="mono">ROI Type</span>
        <select id="roiType" class="select">
          <option value="header">HEADER</option>
          <option value="desc" selected>DESCRIPTION</option>
          <option value="spt">SPT</option>
        </select>
      </div>

      <button id="toggleDrawBtn" class="btn" disabled>Draw Mode: Off</button>

      <button id="extractBtn" class="btn primary" disabled>Extract (this page)</button>
      <button id="exportBtn" class="btn" disabled>Export JSON</button>
      <button id="clearRoiBtn" class="btn" disabled>Clear ROIs (page)</button>
    </div>
  </header>

  <main class="layout">
    <section class="canvasPanel">
      <div class="canvasHeader">
        <div class="row">
          <div class="pill">
            <span>Zoom</span>
            <input id="zoomRange" type="range" min="50" max="250" value="120" />
            <span id="zoomLabel" class="mono">120%</span>
          </div>

          <label class="pill">
            <input id="showRoiChk" type="checkbox" checked />
            <span>Show ROIs</span>
          </label>
        </div>

        <div class="row right">
          <div class="status">
            <div class="mono" id="statusText">Upload a PDF to begin.</div>
            <div class="progressWrap">
              <div class="progressBar" id="progressBar"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="stage" class="stage">
        <canvas id="pdfCanvas" class="canvas"></canvas>
        <canvas id="overlayCanvas" class="canvas overlay"></canvas>
      </div>

      <div class="hint">
        <b>How to use:</b>
        <ol>
          <li>Upload PDF → Render</li>
          <li>Turn Draw Mode ON</li>
          <li>Select ROI Type (HEADER / DESCRIPTION / SPT) and draw one box for each</li>
          <li>Description ROI must cover depth from 0 → Total depth (e.g., 36 ft)</li>
          <li>Click “Extract (this page)” then “Export JSON”</li>
        </ol>
      </div>
    </section>

    <aside class="sidePanel">
      <div class="panel">
        <div class="panelTitle">Selected ROI</div>
        <div class="field">
          <label>Type</label>
          <input id="selType" class="input mono" disabled />
        </div>
        <div class="field grid2">
          <div><label>X</label><input id="selX" class="input mono" disabled /></div>
          <div><label>Y</label><input id="selY" class="input mono" disabled /></div>
          <div><label>W</label><input id="selW" class="input mono" disabled /></div>
          <div><label>H</label><input id="selH" class="input mono" disabled /></div>
        </div>
        <div class="row gap">
          <button id="deleteBtn" class="btn danger" disabled>Delete ROI</button>
        </div>
      </div>

      <div class="panel">
        <div class="panelTitle">Extracted Output (this page)</div>
        <textarea id="outputText" class="textarea" placeholder="Extracted JSON preview will appear here..." spellcheck="false"></textarea>
      </div>
    </aside>
  </main>

  <script src="app.js"></script>
</body>
</html>
